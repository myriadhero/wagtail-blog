FROM python:3.12-alpine

ARG CODE_DIR

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV PIP_DISABLE_PIP_VERSION_CHECK 1
ENV PIPENV_VENV_IN_PROJECT 1
ENV PIPENV_CACHE_DIR ${CODE_DIR}/pipenv_cache/
ENV DJANGO_DEBUG True

WORKDIR ${CODE_DIR}
COPY Pipfile Pipfile.lock ${CODE_DIR}

RUN pip install pipenv && pipenv sync && mkdir app

ENV PATH "${CODE_DIR}/.venv/bin:$PATH"

WORKDIR ${CODE_DIR}/app/